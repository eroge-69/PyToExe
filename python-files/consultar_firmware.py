
from onvif import ONVIFCamera
import csv
import socket

# Usuario y contraseña
USER = 'admin'
PASS = 'sampol2016'

# Lista de IPs
ips = [
    "10.50.0.10", "10.50.0.101", "10.50.0.102", "10.50.0.104", "10.50.0.11", "10.50.0.13",
    "10.50.0.14", "10.50.0.15", "10.50.0.16", "10.50.0.17", "10.50.0.8", "10.50.0.19",
    "10.50.0.2", "10.50.0.20", "10.50.0.21", "10.50.0.22", "10.50.0.23", "10.50.0.24",
    "10.50.0.25", "10.50.0.26", "10.50.0.27", "10.50.0.28", "10.50.0.29", "10.50.0.3",
    "10.50.0.30", "10.50.0.31", "10.50.0.32", "10.50.0.33", "10.50.0.34", "10.50.0.35",
    "10.50.0.36", "10.50.0.37", "10.50.0.38", "10.50.0.39", "10.50.0.40", "10.50.0.41",
    "10.50.0.42", "10.50.0.43", "10.50.0.44", "10.50.0.45", "10.50.0.46", "10.50.0.47",
    "10.50.0.48", "10.50.0.49", "10.50.0.5", "10.50.0.50", "10.50.0.51", "10.50.0.52",
    "10.50.0.53", "10.50.0.54", "10.50.0.55", "10.50.0.56", "10.50.0.57", "10.50.0.58",
    "10.50.0.59", "10.50.0.6", "10.50.0.60", "10.50.0.61", "10.50.0.62", "10.50.0.63",
    "10.50.0.64", "10.50.0.65", "10.50.0.66", "10.50.0.67", "10.50.0.68", "10.50.0.69",
    "10.50.0.7", "10.50.0.70", "10.50.0.71", "10.50.0.72", "10.50.0.73", "10.50.0.74",
    "10.50.0.75", "10.50.0.76", "10.50.0.77", "10.50.0.78", "10.50.0.79", "10.50.0.80",
    "10.50.0.81", "10.50.0.82", "10.50.0.83", "10.50.0.84", "10.50.0.85", "10.50.0.86",
    "10.50.0.87", "10.50.0.89", "10.50.0.9", "10.50.0.90", "10.50.0.91", "10.50.0.93",
    "10.50.0.96", "10.50.0.97", "10.50.0.98", "10.50.0.88", "10.50.0.12", "10.50.0.92",
    "10.50.0.94", "10.50.0.95", "10.50.0.103", "10.50.0.106", "10.50.0.107", "10.50.0.108",
    "10.50.0.109", "10.50.0.110", "10.50.0.111", "10.50.0.112", "10.50.0.113", "10.50.0.114",
    "10.50.0.115", "10.50.0.116", "10.50.0.117", "10.50.0.118", "10.50.0.119", "10.50.0.120",
    "10.50.0.121", "10.50.0.122", "10.50.0.123", "10.50.0.124", "10.50.0.125", "10.50.0.99",
    "10.50.0.100", "10.50.0.135", "10.50.0.22"
]

# Archivo CSV de salida
output_file = "firmware_camaras.csv"

with open(output_file, mode='w', newline='') as file:
    writer = csv.writer(file)
    writer.writerow(['IP', 'Modelo', 'Firmware'])

    for ip in ips:
        try:
            print(f"Conectando a {ip}...")
            cam = ONVIFCamera(ip, 80, USER, PASS)
            devicemgmt = cam.create_devicemgmt_service()
            info = devicemgmt.GetDeviceInformation()
            writer.writerow([ip, info.Model, info.FirmwareVersion])
            print(f"✔ {ip} -> Modelo: {info.Model}, Firmware: {info.FirmwareVersion}")
        except socket.timeout:
            print(f"✖ {ip} -> Tiempo de espera agotado.")
            writer.writerow([ip, "Timeout", "Timeout"])
        except Exception as e:
            print(f"✖ {ip} -> Error: {e}")
            writer.writerow([ip, "Error", str(e)])

print(f"✅ Reporte generado: {output_file}")
